<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Roulette Casino</title>
<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    min-height: 100vh;
    /* DÃ©gradÃ© bleu nuit profond */
    background: radial-gradient(circle at top, #1e3a8a, #0f172a, #020617);
    font-family: 'Segoe UI', system-ui, Arial, sans-serif;
    color: #f0f9ff;
    display: flex;
    justify-content: center;
    align-items: center;
}

.card {
    width: 100%;
    max-width: 420px;
    /* Fond bleu trÃ¨s sombre semi-transparent */
    background: rgba(15, 23, 42, 0.95);
    border-radius: 20px;
    padding: 22px;
    border: 1px solid #3b82f6;
    box-shadow: 0 0 40px rgba(59, 130, 246, 0.2);
}

h1, h2, h3 {
    text-align: center;
    margin: 12px 0;
    color: #60a5fa; /* Bleu clair brillant */
    text-transform: uppercase;
    letter-spacing: 1px;
}

input {
    width: 100%;
    padding: 12px;
    margin: 6px 0;
    border-radius: 10px;
    border: 1px solid #1e40af;
    background: #0f172a;
    color: #bfdbfe;
    outline: none;
}

input:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 8px rgba(96, 165, 250, 0.4);
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border: none;
    border-radius: 10px;
    /* DÃ©gradÃ© bleu Ã©lectrique */
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.1s, opacity 0.2s;
}

button:hover {
    opacity: 0.9;
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
}

button:active {
    transform: scale(0.98);
}

.secondary {
    background: #1e293b;
    color: #94a3b8;
    border: 1px solid #334155;
}

.msg {
    font-size: 14px;
    text-align: center;
    min-height: 18px;
    color: #7dd3fc; /* Cyan clair pour les messages */
}

.emoji-row {
    text-align: center;
    font-size: 48px;
    margin: 15px 0;
    /* Effet de lueur derriÃ¨re les emojis */
    filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));
}

.credit-box {
    text-align: center;
    font-size: 24px;
    margin: 10px 0;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
}
</style>

</head>
<body>

<div class="card">
<h1>ğŸ¡ Roulette</h1>
<div class="credit-box">ğŸ’° <span id="credits">0</span> crÃ©dits</div>

<input id="bet" type="number" placeholder="Mise">
<button id="spinBtn">ğŸ° Lancer</button>
<div class="emoji-row" id="emojis">â“ â“ â“</div>
<div class="msg" id="resultMsg"></div>
<button id="backBtn" class="secondary">â¬… Retour</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDAQALLN99kqiYY4UZz9wl2stedP5KQ5mA",
  authDomain: "casino-b23c9.firebaseapp.com",
  databaseURL: "https://casino-b23c9-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "casino-b23c9",
  storageBucket: "casino-b23c9.firebasestorage.app",
  messagingSenderId: "139229793155",
  appId: "1:139229793155:web:953b31b383a87bc3c504b6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// UTILISATEUR
const currentUser = localStorage.getItem("casinoUser");
if(!currentUser){
    alert("Vous devez vous connecter d'abord !");
    window.location.href = "casino.html";
}

// DOM
const creditsEl = document.getElementById("credits");
const betInput = document.getElementById("bet");
const spinBtn = document.getElementById("spinBtn");
const emojisDiv = document.getElementById("emojis");
const resultMsg = document.getElementById("resultMsg");
const backBtn = document.getElementById("backBtn");

const symbols = ["ğŸ’","ğŸ’","â­","ğŸ€","7ï¸âƒ£"];

// Met Ã  jour crÃ©dits affichÃ©s
async function updateCredits(){
    const snap = await get(ref(db,"users/"+currentUser));
    creditsEl.textContent = snap.exists() ? snap.val().credits : 0;
}

// GÃ©nÃ¨re 3 Ã©mojis alÃ©atoires
function randomEmojis(){
    return [0,1,2].map(()=>symbols[Math.floor(Math.random()*symbols.length)]);
}

// Calcul multiplicateur selon ton tableau
function calculateMultiplier(arr){
    const counts = {};
    arr.forEach(e => counts[e] = (counts[e]||0)+1);

    // TrÃ¨fle ğŸ€
    if(counts["ğŸ€"]===3) return 0.75;
    if(counts["ğŸ€"]===2) return 0.5;

    // Cerises ğŸ’
    if(counts["ğŸ’"]===3) return 1.25;
    if(counts["ğŸ’"]===2) return 0.75;

    // Ã‰toile â­
    if(counts["â­"]===3) return 2.0;
    if(counts["â­"]===2) return 1.15;

    // Sept 7ï¸âƒ£
    if(counts["7ï¸âƒ£"]===3) return 3.0;
    if(counts["7ï¸âƒ£"]===2) return 1.5;

    // Diamant ğŸ’
    if(counts["ğŸ’"]===3) return 5.0;
    if(counts["ğŸ’"]===2) return 2.5;

    return 0.0; // si aucun combo
}

// Lancer roulette
async function spin(){
    const bet = Number(betInput.value);
    const snap = await get(ref(db,"users/"+currentUser));
    if(!snap.exists()) return alert("Utilisateur inconnu");

    const credits = snap.val().credits;
    if(bet <=0 || bet>credits){
        resultMsg.textContent = "Mise invalide";
        return;
    }

    const roll = randomEmojis();
    emojisDiv.textContent = roll.join(" ");

    const mult = calculateMultiplier(roll);
    let gainTotal = Math.floor(bet * mult);

    // Si multiplicateur < 1, on perd toute la mise
    if(mult < 1) gainTotal = 0;

    const net = gainTotal - bet;

    await update(ref(db,"users/"+currentUser),{
        credits: credits + net,
        balance: snap.val().balance + net,
        password: snap.val().password
    });

    updateCredits();

    if(mult >= 0.75){
        resultMsg.textContent = `GagnÃ© ! x${mult} â†’ +${gainTotal + bet} crÃ©dits`;
    } else {
        resultMsg.textContent = `Perdu ğŸ˜¢ x${mult} â†’ -${bet} crÃ©dits`;
    }
}

// Events
spinBtn.onclick = spin;
backBtn.onclick = ()=>window.location.href="casino.html";

// Initialisation
updateCredits();
</script>

</body>
</html>
